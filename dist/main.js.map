{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/js/isArray.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isNull.js","webpack:///../commons/js/isObject.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/obj/from.js","webpack:///../commons/js/isNumeric.js","webpack:///../commons/js/isFunction.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/obj/each.js","webpack:///./src/internal/Event.js","webpack:///./src/internal/QueryEvent.js","webpack:///../commons/js/isPlainObject.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///./src/internal/Fireable.js","webpack:///./src/internal/Firebase.js","webpack:///../commons/arr/intersect.js","webpack:///./src/internal/Trap.js","webpack:///./src/internal/TrapBase.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/obj/copy.js","webpack:///../commons/obj/merge.js","webpack:///./src/internal/MutationEvent.js","webpack:///./src/internal/ObserverBase.js","webpack:///./src/unobserve.js","webpack:///./src/disconnect.js","webpack:///../commons/js/getType.js","webpack:///../commons/obj/get.js","webpack:///./src/internal/Observer.js","webpack:///../commons/str/after.js","webpack:///../commons/arr/crossJoin.js","webpack:///./src/observe.js","webpack:///./src/connect.js","webpack:///./src/transaction.js","webpack:///../commons/arr/unique.js","webpack:///./src/get.js","webpack:///../commons/arr/all.js","webpack:///../commons/js/isNumber.js","webpack:///./src/has.js","webpack:///./src/_setProp.js","webpack:///./src/set.js","webpack:///./src/init.js","webpack:///./src/_getProps.js","webpack:///./src/keys.js","webpack:///./src/trap.js","webpack:///./src/def.js","webpack:///./src/del.js","webpack:///./src/index.js","webpack:///./src/build.js","webpack:///./src/untrap.js","webpack:///./src/ownKeys.js","webpack:///./src/browser-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Array","isArray","val","arguments","length","undefined","castObject","keys","slice","values","obj","forEach","k","isNaN","toString","returnValue","callback","parseFloat","target","details","this","$","prop","Event","super","getPrototypeOf","_even","obj1","obj2","assertion","depth","obj1Keys","obj2Keys","result","contn","v1","testPass","v2","netComparison","push","contrast","returnOnFirstFalse","disconnected","fireables","currentlyFiringEvents","fireable","Fireable","Error","tags","filter","_fireable","query","observer","handler","params","type","arr2","arr","val1","val2","indexOf","Base","firebases","firebaseKey","set","evt","next","total","QueryEvent","Firebase","defaultHandler","e","index","_args","trap","fire","args","pop","createForTarget","getForTarget","items","itm","keysAll","until","prototypalChain","getOwnPropertyNames","objs","shift","deepProps","valAtObj1","valAtObj2","isReplace","withSymbols","getOwnPropertyDescriptor","data","fields","srcEvt","originatingTarget","originatingType","originatingFields","originatingData","_originatingData","field","path","_path","originatingCreated","originatingDeleted","_data","created","deleted","propagationStopped","defaultPrevented","promisesInstance","promises","promise","Promise","all","rspns","proms","stopPropagation","preventDefault","findFireables","MutationEvent","firebase","originalCallback","removeFireable","unobserve","reciever","_ctxt","ctxt","_key","exists","fieldsArray","isDynamicField","startsWith","endsWith","join","fireCallback","fieldData","reduce","originatingField","_value","fieldQuery","search","subject","pos","afterLast","lastIndexOf","substr","split","currentValue","response","prevValue","dynamicFieldOutcomes","observedField","inputOriginatingField","inputOriginatingFieldSplit","observedDynamicFieldOutcome","map","seg","observeUp","observeDown","currTable","column","newTable","row","_row","addFireable","Observer","observe","entries","_entries","base","bubbling","context","targets","targetCopy","setData","_setData","delData","_delData","cntxt","mutationBase","initialKeys","currentKeys","changedKeys","concat","self","includes","disconnect","connect","returnEvent","trapBase","defaultGet","transaction","apply","prevTest","defaultHas","_state","keysOrPayload","handleSet","descriptor","define","success","defaultSet","_success","successStates","state","_setProp","onGetFire","onSetFire","currentDescriptor","writable","newValue","defaultKeys","_keys","ownKeys","_getProps","defaultDel","build","_init","init","Trap","untrap","def","del","deleteProperty","has","window","WebNative","Reflex"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n * @param bool\t \tcastObject\r\n *\r\n * @return array\r\n */\r\nexport default function(val, castObject = true) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (!castObject && _isObject(val)) {\r\n\t\treturn [val];\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach((k, i) => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k], i);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tthis.$ = {};\r\n\t\tthis.$.target = target;\r\n\t\tthis.$.details = details;\r\n\t\t_each(details, (prop, value) => {\r\n\t\t\tif (prop !== '$') {\r\n\t\t\t\tObject.defineProperty(this, prop, {value});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"target\" object.\r\n\t *\r\n\t * @return array|object\r\n\t */\r\n\tget target() {\r\n\t\treturn this.$.target;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"details\" object.\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tget details() {\r\n\t\treturn this.$.details;\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The QueryEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tsuper(target, details);\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if an object is direct instance of Object.prototype.\r\n * Quite useful in differentiating native objects and class instances from plain objects ({}).\r\n *\r\n * @param object \tobj\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj) {\r\n\treturn _isObject(obj) && Object.getPrototypeOf(obj) === Object.prototype;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isPlainObject from '../js/isPlainObject.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif (_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length) {\r\n\t\treturn !assertion;\r\n\t} else if (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tif ((!Object.keys(obj1).length || !Object.keys(obj2).length)\r\n\t\t&& (!_isPlainObject(obj1) || !_isPlainObject(obj2))) {\r\n\t\t\t// Objects that won't show keys must be compared by instance\r\n\t\t\t// Many native objects won't. So we can't judge by keys alone.\r\n\t\t\treturn (obj1 === obj2) === assertion;\r\n\t\t} else {\r\n\t\t\tvar obj1Keys = Object.keys(obj1);\r\n\t\t\tvar obj2Keys = Object.keys(obj2);\r\n\t\t\tif (obj1Keys.length !== obj2Keys.length || !_even(obj1Keys, obj2Keys)) {\r\n\t\t\t\treturn !assertion;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\tif (_isTypeObject(v1) && v1 && _isTypeObject(v2) && v2) {\r\n\t\t\treturn _even(Object.keys(v1), Object.keys(v2), assertion);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (isNaN(v1) && isNaN(v2) ? assertion : (v1 === v2) === assertion);\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * ---------------------------\r\n * The Fireable class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Sets a \"disconnected\" flag on the Fireable.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tdisconnect() {\r\n\t\tthis.disconnected = true;\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Firebase class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.fireables = [];\r\n\t\tthis.currentlyFiringEvents = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t *\r\n\t * @return Fireable\r\n\t */\r\n\taddFireable(fireable) {\r\n\t\tif (!(fireable instanceof Fireable)) {\r\n\t\t\tthrow new Error('Firebase.addFireable() expects an instance of Fireable.');\r\n\t\t}\r\n\t\tthis.fireables.push(fireable);\r\n\t\treturn fireable;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Removes an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t * @param array\t\t\t\ttags\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tremoveFireable(fireable, tags = []) {\r\n\t\tif (!(fireable instanceof Fireable)) {\r\n\t\t\tthrow new Error('Firebase.removeFireable() expects an instance of Fireable.');\r\n\t\t}\r\n\t\tthis.fireables = this.fireables.filter(_fireable => _fireable !== fireable);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn this.fireables.filter(observer => {\r\n\t\t\treturn (!query.handler || observer.handler === query.handler) && (!query.params || (\r\n\t\t\t\t(!query.params.type || observer.params.type === query.params.type)\r\n\t\t\t\t&& (!query.params.tags || _intersect(observer.params.tags || [], query.params.tags).length === query.params.tags.length)\r\n\t\t\t));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic createForTarget (object, type, Base) {\r\n\t\tif (object && _isTypeObject(object)) {\r\n\t\t\tvar firebases;\r\n\t\t\tif (!(firebases = object[firebaseKey])) {\r\n\t\t\t\tfirebases = {};\r\n\t\t\t\tObject.defineProperty(object, firebaseKey, {\r\n\t\t\t\t\tget:() => firebases,\r\n\t\t\t\t\tset:value => {\r\n\t\t\t\t\t\tif (value !== firebases) {\r\n\t\t\t\t\t\t\tthrow new Error('Attempt to overwrite the \"' + firebaseKey + '\" special property!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tenumerable:false,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tfirebases[type] = new Base;\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic getForTarget(object, type) {\r\n\t\tvar firebases;\r\n\t\tif (object && _isTypeObject(object) && (firebases = object[firebaseKey])) {\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var string\r\n */\r\nconst firebaseKey = '< r e f l e c t >';\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Trap class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.params = params;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t * @param function\t\t\t\t\tnext\r\n\t * @param mixed\t\t\t\t\t \ttotal\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt, next, total) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn next(..._arrFrom(arguments).slice(2));\r\n\t\t}\r\n\t\tif (!(evt instanceof QueryEvent)) {\r\n\t\t\tthrow new Error('Trap.fire() expects an instance of QueryEvent.');\r\n\t\t}\r\n\t\treturn this.handler(evt.target, total, next, evt);\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Firebase from './Firebase.js';\r\nimport Trap from './Trap.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class TrapBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t * @param function\t\t\tdefaultHandler\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tfire(evt, defaultHandler = null) {\r\n\t\tif (!(evt instanceof QueryEvent)) {\r\n\t\t\tthrow new Error('TrapBase.fire() expects evt to be an instance of QueryEvent.');\r\n\t\t}\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.query === evt.query).length) {\r\n\t\t\treturn defaultHandler ? defaultHandler() : undefined;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tconst next = (index, ..._args) => {\r\n\t\t\tvar trap = this.fireables[index];\r\n\t\t\tif (trap) {\r\n\t\t\t\treturn trap.fire(evt, (...args) => {\r\n\t\t\t\t\treturn next(index + 1, ...args);\r\n\t\t\t\t}/*next*/, ..._args);\r\n\t\t\t}\r\n\t\t\treturn defaultHandler ? defaultHandler(..._args) : _args[0];\r\n\t\t};\r\n\t\tvar value = next(0);\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'traps', TrapBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'traps');\r\n\t}\r\n};","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The MutationEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tif (details.data) {\r\n\t\t\tdetails.fields = Object.keys(details.data);\r\n\t\t}\r\n\t\tsuper(target, details);\r\n\t\t// -----------------------\r\n\t\tif (this.srcEvt) {\r\n\t\t\tthis.originatingTarget = this.srcEvt.originatingTarget;\r\n\t\t\tthis.originatingType = this.srcEvt.originatingType;\r\n\t\t\tthis.originatingFields = [];\r\n\t\t\tthis.originatingData = {};\r\n\t\t\tthis._originatingData = {};\r\n\t\t\tvar field = this.fields[0];\r\n\t\t\tObject.keys(this.srcEvt.originatingData).forEach(path => {\r\n\t\t\t\tvar _path = field + '.' + path;\r\n\t\t\t\tthis.originatingFields.push(_path);\r\n\t\t\t\tthis.originatingData[_path] = this.srcEvt.originatingData[path];\r\n\t\t\t\tthis._originatingData[_path] = this.srcEvt._originatingData[path];\r\n\t\t\t});\r\n\t\t\tthis.originatingCreated = this.srcEvt.originatingCreated;\r\n\t\t\tthis.originatingDeleted = this.srcEvt.originatingDeleted;\r\n\t\t} else {\r\n\t\t\tthis.originatingTarget = this.target;\r\n\t\t\tthis.originatingType = this.type;\r\n\t\t\tthis.originatingFields = this.fields;\r\n\t\t\tthis.originatingData = this.data;\r\n\t\t\tthis._originatingData = this._data;\r\n\t\t\tthis.originatingCreated = this.created;\r\n\t\t\tthis.originatingDeleted = this.deleted;\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\tthis.$.propagationStopped = false;\r\n\t\tthis.$.defaultPrevented = false;\r\n\t\tthis.$.promisesInstance = null;\r\n\t\tthis.$.promises = [];\r\n\t}\r\n\r\n\t/**\r\n\t * -----------------------\r\n\t * RESPONSE HANDLERS\r\n\t * -----------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Evaluates the given disposition value and\r\n\t * calls an appropriate disposition method.\r\n\t *\r\n\t * @params mixed \trspns\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresponse(rspns) {\r\n\t\tvar proms;\r\n\t\tif ((rspns === false) || (rspns instanceof Event && rspns.propagationStopped)) {\r\n\t\t\tthis.stopPropagation();\r\n\t\t} else if ((rspns === false) || (rspns instanceof Event && rspns.defaultPrevented)) {\r\n\t\t\tthis.preventDefault();\r\n\t\t} else if ((rspns instanceof Promise && (proms = rspns))\r\n\t\t|| (rspns instanceof Event && (proms = rspns.promises))) {\r\n\t\t\tthis.promise(proms);\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _concatUnique from '@web-native-js/commons/arr/concatUnique.js';\r\nimport _exclude from '@web-native-js/commons/arr/exclude.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport Firebase from './Firebase.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class ObserverBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn super.findFireables(query).filter(observer => {\r\n\t\t\treturn _isNull(query.fields) || _isUndefined(query.fields) || _even(_arrFrom(observer.fields), _arrFrom(query.fields));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (!(evt instanceof MutationEvent)) {\r\n\t\t\tthrow new Error('ObserverBase.fire() expects evt to be an instance of MutationEvent.');\r\n\t\t}\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.fields === evt.fields).length) {\r\n\t\t\treturn evt;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tthis.fireables.forEach(observer => {\r\n\t\t\tif (evt.propagationStopped || (observer.params.type && observer.params.type !== evt.type)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tobserver.fire(evt);\r\n\t\t});\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn evt;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'observers', ObserverBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'observers');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes an observer from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, fields, originalCallback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields) || _isNull(fields) || _isUndefined(fields)) {\r\n\t\tparams = arguments.length > 2 ? originalCallback : {};\r\n\t\toriginalCallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, fields, params}).forEach(observer => {\r\n\t\t\tfirebase.removeFireable(observer);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport unobserve from './unobserve.js';\r\n\r\n/**\r\n * Unbubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tunobserve(object, null, {tags:['#e-bubbling', target]});\r\n}\r\n","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\ttrap\r\n * @param object \t\t\t\treciever\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, trap = {}, reciever = {}) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tif (!(trap.get ? trap.get(_ctxt, _key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = trap.get ? trap.get(_ctxt, _key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _crossJoin from '@web-native-js/commons/arr/crossJoin.js';\r\nimport _pushUnique from '@web-native-js/commons/arr/pushUnique.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _strAfter from '@web-native-js/commons/str/after.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _commonsGet from '@web-native-js/commons/obj/get.js';\r\nimport Fireable from './Fireable.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport reflexGet from '../get.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observer class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param string|array\tfields\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, fields = null, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.fields = fields;\r\n\t\tthis.params = params;\r\n\t\t// -----------------------\r\n\t\tthis.fieldsArray = _arrFrom(this.fields);\r\n\t\tthis.isDynamicField = this.fieldsArray.filter(\r\n\t\t\tfield => field.indexOf('..') > -1 || field.startsWith('.') || field.endsWith('.')\r\n\t\t).length;\r\n\t\tif (this.isDynamicField && this.fieldsArray.length > 1) {\r\n\t\t\tthrow new Error('Only one \"Dynamic Field\" must be observed at a time! \"' + this.fieldsArray.join(', ') + '\" have been bound together.');\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!(evt instanceof MutationEvent)) {\r\n\t\t\tthrow new Error('Observer.fire() expects an instance of MutationEvent.');\r\n\t\t}\r\n\t\tthis.fireCallback(evt, fields => {\r\n\t\t\tif (fields) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar data = [];\r\n\t\t\t\tvar _data = [];\r\n\t\t\t\tfields.forEach(field => {\r\n\t\t\t\t\t// --------------------------\r\n\t\t\t\t\t// The NEW/OLD values of the change of field which could be a path\r\n\t\t\t\t\tvar fieldData = evt.originatingFields.reduce((fieldData, originatingField) => {\r\n\t\t\t\t\t\t// So field is the exact originatingField path?\r\n\t\t\t\t\t\tvar value = evt.originatingData[originatingField];\r\n\t\t\t\t\t\tvar _value = evt._originatingData[originatingField];\r\n\t\t\t\t\t\tif (!fieldData && field === originatingField) {\r\n\t\t\t\t\t\t\treturn [value, _value];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Field matches, but is deeper than, originatingField path?\r\n\t\t\t\t\t\tif (!fieldData && (field + '.').startsWith((originatingField + '.'))) {\r\n\t\t\t\t\t\t\tvar fieldQuery = _strAfter(field, originatingField + '.');\r\n\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t// Notice we're using _commonsGet to dig the path\r\n\t\t\t\t\t\t\t\t// but with reflexGet as trap for \"reactive getting\"\r\n\t\t\t\t\t\t\t\t_commonsGet(value, fieldQuery.split('.'), {get:reflexGet}),\r\n\t\t\t\t\t\t\t\t_commonsGet(_value, fieldQuery.split('.'), {get:reflexGet})\r\n\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn fieldData;\r\n\t\t\t\t\t}, null);\r\n\t\t\t\t\t// --------------------------\r\n\t\t\t\t\tif (fieldData) {\r\n\t\t\t\t\t\tdata.push(fieldData.shift());\r\n\t\t\t\t\t\t_data.push(fieldData.shift());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar currentValue = _commonsGet(evt.target, _isString(field) ? field.split('.') : field, {get:reflexGet});\r\n\t\t\t\t\t\tdata.push(currentValue);\r\n\t\t\t\t\t\t_data.push(currentValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn _isArray(this.fields) // NOTE:we're asking the original format!\r\n\t\t\t\t\t? evt.response(this.handler(data, _data, evt))\r\n\t\t\t\t\t: evt.response(this.handler(data[0], _data[0], evt));\r\n\t\t\t}\r\n\t\t\tvar data = {};\r\n\t\t\tvar _data = {};\r\n\t\t\tevt.fields.forEach(field => {\r\n\t\t\t\t// Remeber that evt.originatingData might actually be bubbling\r\n\t\t\t\t// in which case we don't expect to see eventName key.\r\n\t\t\t\tvar currentValue = field in evt.data \r\n\t\t\t\t\t? evt.data[field] \r\n\t\t\t\t\t: reflexGet(evt.target, field);\r\n\t\t\t\tvar prevValue = field in evt._data\r\n\t\t\t\t\t? evt._data[field] \r\n\t\t\t\t\t: currentValue;\r\n\t\t\t\tdata[field] = currentValue;\r\n\t\t\t\t_data[field] = prevValue;\r\n\t\t\t});\r\n\t\t\t// Call listener...\r\n\t\t\treturn evt.response(this.handler(data, _data, evt));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Validates a proposed fire operation.\r\n\t *\r\n\t * @param MutationEvent\t\t \tevt\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tfireCallback(evt, callback) {\r\n\t\tif (this.fieldsArray.length) {\r\n\t\t\tvar dynamicFieldOutcomes = [];\r\n\t\t\tvar matches = this.fieldsArray.filter((observedField, i) => {\r\n\t\t\t\tdynamicFieldOutcomes[i] = [];\r\n\t\t\t\treturn evt.originatingFields.filter(inputOriginatingField => {\r\n\t\t\t\t\tvar inputOriginatingFieldSplit = inputOriginatingField.split('.');\r\n\t\t\t\t\tvar observedDynamicFieldOutcome = this.isDynamicField \r\n\t\t\t\t\t\t? observedField.split('.').map((seg, k) => seg || inputOriginatingFieldSplit[k] || '').join('.')\r\n\t\t\t\t\t\t: observedField;\r\n\t\t\t\t\t_pushUnique(dynamicFieldOutcomes[i], observedDynamicFieldOutcome);\r\n\t\t\t\t\treturn (observedDynamicFieldOutcome === inputOriginatingField\r\n\t\t\t\t\t\t|| (this.params.observeUp !== false && (observedDynamicFieldOutcome + '.').startsWith(inputOriginatingField + '.'))\r\n\t\t\t\t\t\t|| (this.params.observeDown && (inputOriginatingField + '.').startsWith(observedDynamicFieldOutcome + '.'))\r\n\t\t\t\t\t) && (!this.isDynamicField || !observedDynamicFieldOutcome.split('.').filter(seg => !seg).length);\r\n\t\t\t\t}).length;\r\n\t\t\t}).length;\r\n\t\t\tif (matches) {\r\n\t\t\t\t_crossJoin(dynamicFieldOutcomes).forEach(callback);\r\n\t\t\t}\r\n\t\t} else if (evt.fields === evt.originatingFields || this.params.observeDown) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from './from.js';\r\n\r\n/**\r\n * Accepts a list of column and joins them to a table.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nexport default function(arr) {\r\n\treturn arr.reduce((currTable, column) => {\r\n\t\tvar newTable = [];\r\n\t\tcurrTable.forEach(row => {\r\n\t\t\t_arrFrom(column).forEach(column => {\r\n\t\t\t\tvar _row = row.slice();\r\n\t\t\t\t_row.push(column);\r\n\t\t\t\tnewTable.push(_row);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn newTable;\r\n\t}, [[]]);\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport Observer from './internal/Observer.js';\r\n\r\n/**\r\n * Adds an observer to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Observer\r\n */\r\nexport default function(object, fields, callback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields)) {\r\n\t\tparams = arguments.length > 2 ? callback : {};\r\n\t\tcallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = ObserverBase.getForTarget(object))) {\r\n\t\tfirebase = ObserverBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Observer(callback, fields, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport observe from './observe.js';\r\n\r\n/**\r\n * Bubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tvar firebase;\r\n\tobserve(object, (entries, _entries, e) => {\r\n\t\tif (firebase = ObserverBase.getForTarget(target)) {\r\n\t\t\tvar base = _objFrom(field, object);\r\n\t\t\treturn firebase.fire(new MutationEvent(target, {type:e.type, bubbling:true, data:base, _data:base, srcEvt:e}));\r\n\t\t}\r\n\t}, {observeDown:true, tags:['#e-bubbling', target]});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@web-native-js/commons/obj/copy.js';\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport connect from './connect.js';\r\n\r\n/**\r\n * Executes a callback function on a target in \"mutation\" mode.\r\n * Fires any observers that may be bound to target on recorded changes.\r\n *\r\n * @param array\t\t\ttargets\r\n * @param function\t\tcallback\r\n * @param array\t\t\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return array|Event\r\n */\r\nexport default function(targets, callback, keys = [], returnEvent = false) {\r\n\tvar context = targets.map((target, i) => {\r\n\t\tif (!target || !_isTypeObject(target)) {\r\n\t\t\tthrow new Error('Target must be of type object!');\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttarget,\r\n\t\t\ttargetCopy: _copy(target, keys),\r\n\t\t\tsetData: {},\r\n\t\t\t_setData: {},\r\n\t\t\tdelData: {}, \r\n\t\t\t_delData: {},\r\n\t\t\tcreated: [],\r\n\t\t\tdeleted: [],\r\n\t\t};\r\n\t});\r\n\t// ---------------------------------\r\n\tvar result = callback(...targets);\r\n\t// ---------------------------------\r\n\tcontext.map(cntxt => {\r\n\t\tvar initialKeys = Object.keys(cntxt.targetCopy);\r\n\t\tvar currentKeys = Object.keys(cntxt.target);\r\n\t\tvar changedKeys = _unique(initialKeys.concat(currentKeys)).filter(key => {\r\n\t\t\tif ((keys.length && !keys.includes(key)) \r\n\t\t\t|| (_isArray(cntxt.target) && (key === 'length' || key === '< r e f l e c t >'))) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!currentKeys.includes(key)) {\r\n\t\t\t\tcntxt._delData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.delData[key] = undefined;\r\n\t\t\t\tcntxt.deleted.push(key);\r\n\t\t\t} else {\r\n\t\t\t\tcntxt._setData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.setData[key] = cntxt.target[key];\r\n\t\t\t\tif (!initialKeys.includes(key)) {\r\n\t\t\t\t\tcntxt.created.push(key);\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t\tif (cntxt.targetCopy[key] !== cntxt.target[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (cntxt.targetCopy[key] && _isTypeObject(cntxt.targetCopy[key])) {\r\n\t\t\t\t\tdisconnect(cntxt.target, key, cntxt.targetCopy[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (cntxt.target[key] && _isTypeObject(cntxt.target[key])) {\r\n\t\t\t\t\tconnect(cntxt.target, key, cntxt.target[key]);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ---------------------------------\r\n\t\tvar evt, mutationBase;\r\n\t\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(cntxt.target))) {\r\n\t\t\tevt = new MutationEvent(cntxt.target, {\r\n\t\t\t\ttype:'transaction', \r\n\t\t\t\tdata:_merge(cntxt.setData, cntxt.delData),\r\n\t\t\t\t_data:_merge(cntxt._setData, cntxt._delData),\r\n\t\t\t\tcreated:cntxt.created,\r\n\t\t\t\tdeleted:cntxt.deleted\r\n\t\t\t});\r\n\t\t\tif (mutationBase) {\r\n\t\t\t\tif (Object.keys(cntxt.delData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'del', data:cntxt.delData, _data:cntxt._delData, deleted:cntxt.deleted})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t\tif (Object.keys(cntxt.setData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'set', data:cntxt.setData, _data:cntxt._setData, created:cntxt.created})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn returnEvent ? evt : changedKeys;\r\n\t});\r\n\treturn result;\r\n}\r\n","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport transaction from './transaction.js';\r\n\r\n/**\r\n * Runs a \"get\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return mixed\r\n */\r\nexport default function(target, keys) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"get\" traps, otherwise \"get\" the default way\r\n\tvar value, trapBase, defaultGet = function(_value) {\r\n\t\treturn arguments.length ? _value : (_isArray(keys) ? _objFrom(keys, target) : target[keys]);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\tvalue = trapBase.fire(new QueryEvent(target, {type:'get', query:keys}), defaultGet);\r\n\t} else {\r\n\t\tvalue = defaultGet();\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute array methods in \"mutation\" mode\r\n\tif (_isArray(target) && !_isNumeric(keys) && _isFunction(value)) {\r\n\t\treturn function reflexArrayMethodWrapper(...args) {\r\n\t\t\treturn transaction([target], () => {\r\n\t\t\t\treturn value.apply(target, args);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\treturn value;\r\n}\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs an \"in\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tkey\r\n *\r\n * @return bool\r\n */\r\nexport default function(target, key) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"has\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultHas = function(_state) {\r\n\t\treturn arguments.length ? _state : (key in target);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:'has', query:key}), defaultHas);\r\n\t}\r\n\treturn defaultHas();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumber from '@web-native-js/commons/js/isNumber.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport connect from './connect.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"_setProp\" type of operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\tdefine\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(define, target, keysOrPayload, value = null, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tvar keys = keysOrPayload, _data = {}, data = {}, created = [];\r\n\tvar handleSet = (key, value) => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (!reflexHas(target, key)) {\r\n\t\t\tcreated.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tvar descriptor;\r\n\t\tif (define) {\r\n\t\t\tdescriptor = value || {};\r\n\t\t\tvalue = descriptor.value;\r\n\t\t}\r\n\t\t// Execute any \"set\" traps, otherwise \"set\" the default way\r\n\t\tvar success, trapBase, defaultSet = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tif (descriptor) {\r\n\t\t\t\t\tObject.defineProperty(target, key, descriptor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tvar details = descriptor \r\n\t\t\t\t? {type:'define', query:key, descriptor} \r\n\t\t\t\t: {type:'set', query:key, value};\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, details), defaultSet);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultSet();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = value;\r\n\t\t\tif (data[key] !== _data[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\t\tdisconnect(target, key, _data[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (data[key] && _isTypeObject(data[key])) {\r\n\t\t\t\t\tconnect(target, key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t};\r\n\t// ---------------------------------\r\n\tvar successStates = [];\r\n\tif (_isArray(keys) || ((_isString(keys) || _isNumber(keys)) && (keys = _arrFrom(keys)))) {\r\n\t\tsuccessStates = keys.map(key => handleSet(key, value))\r\n\t} else if (_isObject(keysOrPayload)) {\r\n\t\tsuccessStates = Object.keys(keysOrPayload).map(key => handleSet(key, keysOrPayload[key]))\r\n\t\tif (arguments.length > 2) {\r\n\t\t\treturnEvent = value;\r\n\t\t}\r\n\t}\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(target))) {\r\n\t\tevt = new MutationEvent(target, {type:'set', data, _data, created});\r\n\t\tif (mutationBase && Object.keys(data).length) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(false/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport reflexGet from './get.js';\r\nimport reflexSet from './set.js';\r\n\r\n/**\r\n * Initializes \"Reflxive getter/setter\" traps on the target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return void\r\n */\r\nexport default function(target, keys) {\r\n\t_arrFrom(keys).forEach(key => {\r\n\t\tvar value = target[key], onGetFire, onSetFire;\r\n\t\tvar currentDescriptor = Object.getOwnPropertyDescriptor(target, key)\r\n\t\t|| {enumerable: key in target ? false/*existing but hidden*/ : true};\r\n\t\tif ('value' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.value;\r\n\t\t}\r\n\t\tif ('writable' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.writable;\r\n\t\t}\r\n\t\tcurrentDescriptor.get = () => {\r\n\t\t\tif (onGetFire) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tonGetFire = true;\r\n\t\t\tvar _value = reflexGet(target, key);\r\n\t\t\tonGetFire = false;\r\n\t\t\treturn _value;\r\n\t\t};\r\n\t\tcurrentDescriptor.set = newValue => {\r\n\t\t\tif (onSetFire) {\r\n\t\t\t\tvalue = newValue;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tonSetFire = true;\r\n\t\t\tvar rspns = reflexSet(target, key, newValue);\r\n\t\t\tonSetFire = false;\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tObject.defineProperty(target, key, currentDescriptor);\r\n\t});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs a \"getProps\" type of query operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\townKeys\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(ownKeys, target) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"keys\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultKeys = function(_keys) {\r\n\t\treturn arguments.length ? _keys : (\r\n\t\t\townKeys ? Object.getOwnPropertyNames(target) : Object.keys(target)\r\n\t\t);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:ownKeys ? 'ownKeys' : 'keys'}), defaultKeys);\r\n\t}\r\n\treturn defaultKeys();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"keys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(false/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport Trap from './internal/Trap.js';\r\n\r\n/**\r\n * Adds a trap to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Trap\r\n */\r\nexport default function(object, callback, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = TrapBase.getForTarget(object))) {\r\n\t\tfirebase = TrapBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Trap(callback, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(true/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"delete\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keys, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tvar keys = _arrFrom(keys), _data = {}, data = {}, deleted = [];\r\n\tvar successStates = keys.map(key => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (reflexHas(target, key)) {\r\n\t\t\tdeleted.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\t// Execute any \"del\" traps, otherwise \"del\" the default way\r\n\t\tvar success, trapBase, defaultDel = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tdelete target[key];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, {type:'del', query:key}), defaultDel);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultDel();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = undefined;\r\n\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\tdisconnect(target, key, _data[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t});\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(target))) {\r\n\t\tevt = new MutationEvent(target, {type:'del', data, _data, deleted});\r\n\t\tif (mutationBase && Object.keys(data).length) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport build from './build.js';\r\nimport observe from './observe.js';\r\nimport unobserve from './unobserve.js';\r\nimport trap from './trap.js';\r\nimport untrap from './untrap.js';\r\nimport def from './def.js';\r\nimport set from './set.js';\r\nimport del from './del.js';\r\nimport connect from './connect.js';\r\nimport disconnect from './disconnect.js';\r\nimport transaction from './transaction.js';\r\nimport get from './get.js';\r\nimport has from './has.js';\r\nimport init from './init.js';\r\nimport keys from './keys.js';\r\nimport ownKeys from './ownKeys.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\n\r\n// Now we'll mimick standard Trap properties\r\n// so that can be used as standard Trap out of the box.\r\nconst deleteProperty = del;\r\nconst defineProperty = def;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default {\r\n\tbuild,\r\n\tobserve,\r\n\tunobserve,\r\n\ttrap,\r\n\tuntrap,\r\n\tdef,\r\n\tdefineProperty,\r\n\tset,\r\n\tdel,\r\n\tdeleteProperty,\r\n\tconnect,\r\n\tdisconnect,\r\n\ttransaction,\r\n\tget,\r\n\thas,\r\n\tinit,\r\n\tkeys,\r\n\townKeys,\r\n\t// Events\r\n\tMutationEvent,\r\n\tQueryEvent,\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport init from './init.js';\r\nimport reflexKeys from './keys.js';\r\nimport reflexGet from './get.js';\r\nimport connect from './connect.js';\r\n\r\n/**\r\n * Recursively \"connects\" an object's members to the object\r\n * for reflex actions.\r\n *\r\n * @param array|object\ttarget\r\n * @param bool\t\t\t_init\r\n *\r\n * @return void\r\n */\r\nexport default function build(target, _init = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\tvar keys = reflexKeys(target);\r\n\tkeys.forEach(key => {\r\n\t\tvar value = reflexGet(target, key);\r\n\t\tif (_isTypeObject(value) && value) {\r\n\t\t\tconnect(target, key, value);\r\n\t\t\tbuild(value, _init);\r\n\t\t}\r\n\t});\r\n\tif (_init) {\r\n\t\tinit(target, keys);\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes a trap from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, originalCallback, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, params}).forEach(trap => {\r\n\t\t\tfirebase.removeFireable(trap);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"ownKeys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(true/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Reflex from './index.js';\r\n\r\n// As globals\r\nif (!window.WebNative) {\r\n\twindow.WebNative = {};\r\n}\r\nwindow.WebNative.Reflex = Reflex;\r\n"],"sourceRoot":""}